<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RetailFlow SaaS POS</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Babel for in-browser compiling -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      html, body, #root {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom scrollbar for POS item list */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
    </style>
    
    <!-- Polyfill for process.env to prevent crashes on static host -->
    <script>
      window.process = {
        env: {
          API_KEY: '' // API Key would typically be injected here or via build process
        }
      };
    </script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.33.0",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "recharts": "https://esm.sh/recharts@^3.5.1",
    "vite": "https://esm.sh/vite@^7.2.7",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>

    <!-- MAIN APPLICATION LOGIC -->
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef, useCallback } from "https://esm.sh/react@18.2.0";
      import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";
      import { GoogleGenAI } from "https://esm.sh/@google/genai@0.1.1";
      import { 
        LayoutGrid, ShoppingCart, Package, Users, Settings, LogOut, Store,
        Search, Plus, Minus, Trash2, CreditCard, Banknote, RefreshCcw, ScanLine,
        TrendingUp, AlertTriangle, BrainCircuit, Sparkles, ShoppingBag, Check, CheckCircle
      } from "https://esm.sh/lucide-react@0.378.0";
      import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } from "https://esm.sh/recharts@2.12.7";

      // --- TYPES ---
      const UserRole = {
        OWNER: 'OWNER',
        MANAGER: 'MANAGER',
        CASHIER: 'CASHIER',
        ACCOUNTANT: 'ACCOUNTANT'
      };

      // --- CONSTANTS ---
      const MOCK_PRODUCTS = [
        { id: '1', sku: 'DAAL-001', barcode: '8901234567890', name: 'Daal Chana Premium', category: 'Grains', unit: 'kg', price: 280, costPrice: 220, stock: 450, minStockLevel: 50, expiryDate: '2025-12-01' },
        { id: '2', sku: 'OIL-002', barcode: '8901234567891', name: 'Sunridge Cooking Oil 5L', category: 'Oil', unit: 'pc', price: 3200, costPrice: 2800, stock: 120, minStockLevel: 20 },
        { id: '3', sku: 'RICE-003', barcode: '8901234567892', name: 'Super Basmati Rice', category: 'Grains', unit: 'kg', price: 350, costPrice: 290, stock: 800, minStockLevel: 100 },
        { id: '4', sku: 'TEA-004', barcode: '8901234567893', name: 'Tapal Danedar 950g', category: 'Beverages', unit: 'pc', price: 1450, costPrice: 1300, stock: 60, minStockLevel: 15 },
        { id: '5', sku: 'SUGAR-005', barcode: '8901234567894', name: 'Refined Sugar', category: 'Baking', unit: 'kg', price: 160, costPrice: 145, stock: 1200, minStockLevel: 200 },
        { id: '6', sku: 'MILK-006', barcode: '8901234567895', name: 'Olpers Milk 1L', category: 'Dairy', unit: 'carton', price: 3200, costPrice: 2900, stock: 45, minStockLevel: 10, expiryDate: '2024-08-15' },
        { id: '7', sku: 'SPICE-007', barcode: '8901234567896', name: 'National Biryani Masala', category: 'Spices', unit: 'pc', price: 120, costPrice: 85, stock: 300, minStockLevel: 50 },
        { id: '8', sku: 'SOAP-008', barcode: '8901234567897', name: 'Lux Soap Bar', category: 'Personal Care', unit: 'pc', price: 150, costPrice: 110, stock: 15, minStockLevel: 30 }, 
      ];

      const SAAS_PLANS = [
        {
          id: 'starter',
          name: 'Starter',
          price: 'Rs 5,000/mo',
          color: 'bg-green-100 border-green-200 text-green-800',
          features: ['1 Branch', 'Single User', 'Basic Reporting', 'Email Support']
        },
        {
          id: 'business',
          name: 'Business',
          price: 'Rs 12,000/mo',
          color: 'bg-blue-100 border-blue-200 text-blue-800',
          recommended: true,
          features: ['Up to 5 Branches', 'Advanced Inventory', 'Role-based Access', 'Inventory Alerts', 'Priority Support']
        },
        {
          id: 'enterprise',
          name: 'Enterprise',
          price: 'Custom',
          color: 'bg-purple-100 border-purple-200 text-purple-800',
          features: ['Unlimited Branches', 'AI Forecasting', 'Dedicated Account Manager', 'Custom Integrations', 'SLA']
        }
      ];

      const MOCK_SALES_HISTORY = [
        { name: 'Mon', sales: 120000, profit: 24000 },
        { name: 'Tue', sales: 145000, profit: 32000 },
        { name: 'Wed', sales: 132000, profit: 28000 },
        { name: 'Thu', sales: 160000, profit: 38000 },
        { name: 'Fri', sales: 210000, profit: 45000 },
        { name: 'Sat', sales: 280000, profit: 62000 },
        { name: 'Sun', sales: 250000, profit: 55000 },
      ];

      // --- SERVICES ---
      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || '' });

      const getGeminiInsights = async (contextData) => {
        if (!process.env.API_KEY) {
          return "Demo Mode: API Key missing. Connect Google Gemini API to get real-time demand forecasting and strategic insights.";
        }
        try {
          const model = ai.models;
          const prompt = `
            You are an expert Retail Analyst for a large Cash & Carry business.
            Analyze the following dashboard context data and provide 3 key strategic insights.
            Focus on:
            1. Inventory optimization (what to restock or clear).
            2. Sales trends.
            3. A specific action item for the store manager.

            Context:
            ${contextData}

            Keep the response concise, professional, and formatted as a bulleted list using markdown.
          `;

          const response = await model.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
          });

          return response.text;
        } catch (error) {
          console.error("Gemini API Error:", error);
          return "Unable to generate insights at this moment. Please check your connection.";
        }
      };

      const getGoToMarketStrategy = async () => {
          if (!process.env.API_KEY) {
              return "Connect API Key to generate GTM Strategy.";
          }
          try {
              const model = ai.models;
              const prompt = "Create a concise go-to-market strategy for launching a SaaS POS in Pakistan targeting mega marts. Focus on pricing, distribution channels, and unique value propositions.";
              const response = await model.generateContent({
                  model: 'gemini-2.5-flash',
                  contents: prompt
              });
              return response.text;
          } catch (e) {
              return "Failed to fetch strategy.";
          }
      }

      // --- COMPONENT: POS Terminal ---
      const POSTerminal = ({ onProcessSale }) => {
        const [query, setQuery] = useState('');
        const [cart, setCart] = useState([]);
        const [selectedCategory, setSelectedCategory] = useState('All');
        const [activePaymentMethod, setActivePaymentMethod] = useState(null);
        const searchInputRef = useRef(null);

        const categories = ['All', ...Array.from(new Set(MOCK_PRODUCTS.map(p => p.category)))];

        const filteredProducts = MOCK_PRODUCTS.filter(p => {
          const matchesQuery = p.name.toLowerCase().includes(query.toLowerCase()) || 
                              p.sku.toLowerCase().includes(query.toLowerCase()) ||
                              p.barcode.includes(query);
          const matchesCategory = selectedCategory === 'All' || p.category === selectedCategory;
          return matchesQuery && matchesCategory;
        });

        const addToCart = (product) => {
          setCart(prev => {
            const existing = prev.find(item => item.id === product.id);
            if (existing) {
              return prev.map(item => item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item);
            }
            return [...prev, { ...product, quantity: 1, discount: 0 }];
          });
        };

        const updateQuantity = (id, delta) => {
          setCart(prev => prev.map(item => {
            if (item.id === id) {
              const newQty = Math.max(1, item.quantity + delta);
              return { ...item, quantity: newQty };
            }
            return item;
          }));
        };

        const removeFromCart = (id) => {
          setCart(prev => prev.filter(item => item.id !== id));
        };

        const calculateTotal = () => {
          return cart.reduce((acc, item) => acc + (item.price * item.quantity * (1 - item.discount / 100)), 0);
        };

        const handleCheckout = () => {
          if (cart.length === 0) return;
          onProcessSale(calculateTotal(), cart);
          setCart([]);
          setActivePaymentMethod(null);
        };

        useEffect(() => {
          const handleKeyDown = (e) => {
            if (e.key === 'F9') setActivePaymentMethod('CASH');
            if (e.key === 'F10') setActivePaymentMethod('CARD');
            if (e.key === 'Enter' && e.ctrlKey) handleCheckout();
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [cart, activePaymentMethod]);

        useEffect(() => {
          searchInputRef.current?.focus();
        }, []);

        return (
          <div className="flex flex-col lg:flex-row h-[calc(100vh-80px)] gap-4 p-4 bg-slate-50">
            {/* Left: Product Selection */}
            <div className="lg:w-2/3 flex flex-col bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
              <div className="p-4 border-b border-slate-100 space-y-4">
                <div className="relative">
                  <Search className="absolute left-3 top-3 text-slate-400 w-5 h-5" />
                  <input
                    ref={searchInputRef}
                    type="text"
                    placeholder="Scan Barcode / Search Name or SKU (F2)"
                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-lg"
                    value={query}
                    onChange={(e) => setQuery(e.target.value)}
                  />
                  <ScanLine className="absolute right-3 top-3 text-slate-400 w-5 h-5 cursor-pointer" />
                </div>
                
                <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2">
                  {categories.map(cat => (
                    <button
                      key={cat}
                      onClick={() => setSelectedCategory(cat)}
                      className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${
                        selectedCategory === cat 
                        ? 'bg-indigo-600 text-white' 
                        : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                      }`}
                    >
                      {cat}
                    </button>
                  ))}
                </div>
              </div>

              <div className="flex-1 overflow-y-auto p-4 grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 bg-slate-50/50">
                {filteredProducts.map(product => (
                  <div 
                    key={product.id}
                    onClick={() => addToCart(product)}
                    className="bg-white p-3 rounded-xl border border-slate-100 shadow-sm hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer flex flex-col justify-between group h-36"
                  >
                    <div>
                      <h3 className="font-semibold text-slate-800 line-clamp-2 text-sm">{product.name}</h3>
                      <span className="text-xs text-slate-500 font-mono">{product.sku}</span>
                    </div>
                    <div className="flex justify-between items-end mt-2">
                      <div>
                        <div className="text-indigo-600 font-bold">Rs {product.price}</div>
                        <div className="text-[10px] text-slate-400">{product.stock} {product.unit} left</div>
                      </div>
                      <button className="bg-indigo-50 text-indigo-600 p-1.5 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                        <Plus className="w-4 h-4" />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Right: Cart & Checkout */}
            <div className="lg:w-1/3 flex flex-col bg-white rounded-xl shadow-lg border border-slate-200">
              <div className="p-4 border-b border-slate-100 bg-slate-50/50 rounded-t-xl">
                <h2 className="font-bold text-slate-800 flex items-center gap-2">
                  Current Order
                  <span className="bg-indigo-100 text-indigo-700 text-xs px-2 py-0.5 rounded-full">{cart.length} items</span>
                </h2>
              </div>

              <div className="flex-1 overflow-y-auto p-2 space-y-2">
                {cart.length === 0 ? (
                  <div className="h-full flex flex-col items-center justify-center text-slate-400">
                    <ScanLine className="w-12 h-12 mb-2 opacity-50" />
                    <p>Scan item or select from list</p>
                  </div>
                ) : (
                  cart.map(item => (
                    <div key={item.id} className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100 group">
                      <div className="flex-1">
                        <div className="text-sm font-medium text-slate-800">{item.name}</div>
                        <div className="text-xs text-slate-500">Rs {item.price} / {item.unit}</div>
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="flex items-center gap-2 bg-white rounded-lg border border-slate-200 px-1 py-0.5">
                          <button onClick={() => updateQuantity(item.id, -1)} className="p-1 hover:text-red-500"><Minus className="w-3 h-3" /></button>
                          <span className="text-sm w-4 text-center font-medium">{item.quantity}</span>
                          <button onClick={() => updateQuantity(item.id, 1)} className="p-1 hover:text-green-500"><Plus className="w-3 h-3" /></button>
                        </div>
                        <div className="text-right w-16">
                          <div className="text-sm font-bold text-slate-800">{(item.price * item.quantity).toLocaleString()}</div>
                        </div>
                        <button onClick={() => removeFromCart(item.id)} className="text-slate-300 hover:text-red-500"><Trash2 className="w-4 h-4" /></button>
                      </div>
                    </div>
                  ))
                )}
              </div>

              <div className="p-4 bg-slate-50 border-t border-slate-200 rounded-b-xl space-y-4">
                <div className="space-y-2">
                  <div className="flex justify-between text-slate-500 text-sm">
                    <span>Subtotal</span>
                    <span>Rs {calculateTotal().toLocaleString()}</span>
                  </div>
                  <div className="flex justify-between text-slate-500 text-sm">
                    <span>Tax (0%)</span>
                    <span>Rs 0</span>
                  </div>
                  <div className="flex justify-between text-slate-900 text-2xl font-bold pt-2 border-t border-slate-200">
                    <span>Total</span>
                    <span>Rs {calculateTotal().toLocaleString()}</span>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <button 
                      onClick={() => setActivePaymentMethod('CASH')}
                      className={`flex items-center justify-center gap-2 p-4 rounded-xl font-semibold border transition-all ${activePaymentMethod === 'CASH' ? 'bg-green-600 text-white border-green-600 ring-2 ring-green-200' : 'bg-white border-slate-200 text-slate-600 hover:bg-green-50'}`}
                  >
                    <Banknote className="w-5 h-5" />
                    Cash (F9)
                  </button>
                  <button 
                      onClick={() => setActivePaymentMethod('CARD')}
                      className={`flex items-center justify-center gap-2 p-4 rounded-xl font-semibold border transition-all ${activePaymentMethod === 'CARD' ? 'bg-blue-600 text-white border-blue-600 ring-2 ring-blue-200' : 'bg-white border-slate-200 text-slate-600 hover:bg-blue-50'}`}
                  >
                    <CreditCard className="w-5 h-5" />
                    Card (F10)
                  </button>
                </div>

                <button 
                  disabled={cart.length === 0 || !activePaymentMethod}
                  onClick={handleCheckout}
                  className={`w-full py-4 rounded-xl font-bold text-lg text-white shadow-lg transition-all flex items-center justify-center gap-2
                    ${cart.length > 0 && activePaymentMethod ? 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-indigo-500/30' : 'bg-slate-300 cursor-not-allowed'}`}
                >
                  {cart.length > 0 && activePaymentMethod ? 'Complete Sale (Ctrl+Enter)' : 'Select Payment to Proceed'}
                </button>
              </div>
            </div>
          </div>
        );
      };

      // --- COMPONENT: Dashboard ---
      const Dashboard = () => {
        const [insights, setInsights] = useState('');
        const [gtmStrategy, setGtmStrategy] = useState('');
        const [loadingInsights, setLoadingInsights] = useState(false);
        const [loadingGtm, setLoadingGtm] = useState(false);

        const stats = {
          totalSales: 1250000,
          transactionCount: 452,
          lowStockCount: MOCK_PRODUCTS.filter(p => p.stock < p.minStockLevel).length,
          profit: 320000
        };

        const handleGenerateInsights = async () => {
          setLoadingInsights(true);
          const context = `
            Total Sales: Rs ${stats.totalSales}
            Low Stock Items: ${stats.lowStockCount}
            Net Profit: Rs ${stats.profit}
            Top Selling Categories: Grains, Oil
            Recent Trend: Sales up by 15% on weekends.
            Low Stock Items: ${MOCK_PRODUCTS.filter(p => p.stock < p.minStockLevel).map(p => p.name).join(', ')}
          `;
          const result = await getGeminiInsights(context);
          setInsights(result);
          setLoadingInsights(false);
        };

        const handleGenerateGTM = async () => {
            setLoadingGtm(true);
            const res = await getGoToMarketStrategy();
            setGtmStrategy(res);
            setLoadingGtm(false);
        }

        return (
          <div className="p-6 space-y-6 bg-slate-50 min-h-full">
            <div className="flex justify-between items-center">
              <div>
                <h1 className="text-2xl font-bold text-slate-800">Dashboard</h1>
                <p className="text-slate-500 text-sm">Welcome back, Owner. Here is your store overview.</p>
              </div>
              <div className="flex gap-2">
                <span className="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1">
                  <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                  Live Updates
                </span>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              {[
                { label: 'Total Revenue', value: `Rs ${stats.totalSales.toLocaleString()}`, icon: TrendingUp, color: 'bg-indigo-600', trend: '+12%' },
                { label: 'Transactions', value: stats.transactionCount, icon: ShoppingBag, color: 'bg-blue-500', trend: '+5%' },
                { label: 'Low Stock Alerts', value: stats.lowStockCount, icon: AlertTriangle, color: 'bg-rose-500', trend: 'Action Needed' },
                { label: 'Net Profit', value: `Rs ${stats.profit.toLocaleString()}`, icon: Users, color: 'bg-emerald-500', trend: '+18%' },
              ].map((stat, idx) => (
                <div key={idx} className="bg-white p-6 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between">
                  <div>
                    <p className="text-sm font-medium text-slate-500">{stat.label}</p>
                    <h3 className="text-2xl font-bold text-slate-800 mt-1">{stat.value}</h3>
                    <span className={`text-xs font-semibold mt-2 inline-block ${stat.trend.includes('Action') ? 'text-rose-600' : 'text-emerald-600'}`}>
                      {stat.trend}
                    </span>
                  </div>
                  <div className={`${stat.color} p-3 rounded-lg text-white shadow-lg shadow-indigo-100`}>
                    <stat.icon size={24} />
                  </div>
                </div>
              ))}
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <div className="lg:col-span-2 bg-white p-6 rounded-xl border border-slate-100 shadow-sm">
                <h3 className="text-lg font-bold text-slate-800 mb-4">Sales & Profit Overview</h3>
                <div className="h-80 w-full">
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={MOCK_SALES_HISTORY}>
                      <defs>
                        <linearGradient id="colorSales" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="5%" stopColor="#4f46e5" stopOpacity={0.1}/>
                          <stop offset="95%" stopColor="#4f46e5" stopOpacity={0}/>
                        </linearGradient>
                      </defs>
                      <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                      <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#64748b'}} />
                      <YAxis axisLine={false} tickLine={false} tick={{fill: '#64748b'}} />
                      <Tooltip 
                          contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}} 
                      />
                      <Area type="monotone" dataKey="sales" stroke="#4f46e5" strokeWidth={2} fillOpacity={1} fill="url(#colorSales)" />
                      <Area type="monotone" dataKey="profit" stroke="#10b981" strokeWidth={2} fillOpacity={0} />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
              </div>

              <div className="bg-slate-900 text-white p-6 rounded-xl shadow-lg flex flex-col relative overflow-hidden">
                <div className="absolute top-0 right-0 p-3 opacity-10">
                  <BrainCircuit size={100} />
                </div>
                
                <div className="flex items-center gap-2 mb-4">
                  <Sparkles className="text-yellow-400" size={20} />
                  <h3 className="text-lg font-bold">Gemini AI Assistant</h3>
                </div>

                <div className="flex-1 overflow-y-auto mb-4 space-y-4">
                  {!insights && !gtmStrategy && (
                      <div className="text-slate-400 text-sm text-center mt-10">
                          Click below to analyze your store performance using Google Gemini 2.5.
                      </div>
                  )}
                  
                  {loadingInsights && (
                      <div className="animate-pulse space-y-2">
                          <div className="h-2 bg-slate-700 rounded w-3/4"></div>
                          <div className="h-2 bg-slate-700 rounded w-full"></div>
                          <div className="h-2 bg-slate-700 rounded w-5/6"></div>
                      </div>
                  )}

                  {insights && (
                      <div className="prose prose-invert prose-sm">
                          <div className="text-sm leading-relaxed whitespace-pre-line">{insights}</div>
                      </div>
                  )}
                    
                  {gtmStrategy && !loadingInsights && (
                      <div className="mt-4 border-t border-slate-700 pt-4">
                          <h4 className="text-xs font-bold text-emerald-400 uppercase mb-2">Bonus: GTM Strategy</h4>
                          <div className="text-xs text-slate-300 whitespace-pre-line">{gtmStrategy}</div>
                      </div>
                  )}
                </div>

                <div className="flex flex-col gap-2">
                  <button 
                      onClick={handleGenerateInsights}
                      disabled={loadingInsights}
                      className="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg font-medium transition-colors text-sm flex justify-center items-center gap-2"
                  >
                      {loadingInsights ? 'Analyzing...' : 'Generate Store Insights'}
                  </button>
                  <button
                      onClick={handleGenerateGTM}
                      disabled={loadingGtm}
                      className="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg font-medium transition-colors text-sm"
                  >
                      {loadingGtm ? 'Planning...' : 'Ask AI: GTM Strategy'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- COMPONENT: Inventory ---
      const Inventory = () => {
        return (
          <div className="p-6 bg-slate-50 min-h-full">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-2xl font-bold text-slate-800">Inventory Management</h1>
              <button className="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-indigo-700">
                  + Add Product
              </button>
            </div>

            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
              <table className="w-full text-left border-collapse">
                  <thead className="bg-slate-50 border-b border-slate-200">
                      <tr>
                          <th className="p-4 text-xs font-semibold text-slate-500 uppercase">Product Name</th>
                          <th className="p-4 text-xs font-semibold text-slate-500 uppercase">SKU / Barcode</th>
                          <th className="p-4 text-xs font-semibold text-slate-500 uppercase">Category</th>
                          <th className="p-4 text-xs font-semibold text-slate-500 uppercase text-right">Price (PKR)</th>
                          <th className="p-4 text-xs font-semibold text-slate-500 uppercase text-center">Stock Level</th>
                          <th className="p-4 text-xs font-semibold text-slate-500 uppercase text-center">Status</th>
                      </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-100">
                      {MOCK_PRODUCTS.map(product => (
                          <tr key={product.id} className="hover:bg-slate-50/50">
                              <td className="p-4">
                                  <div className="font-medium text-slate-800">{product.name}</div>
                                  {product.expiryDate && <div className="text-xs text-slate-400">Exp: {product.expiryDate}</div>}
                              </td>
                              <td className="p-4 text-sm text-slate-600 font-mono">
                                  <div>{product.sku}</div>
                                  <div className="text-xs text-slate-400">{product.barcode}</div>
                              </td>
                              <td className="p-4">
                                  <span className="bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs">{product.category}</span>
                              </td>
                              <td className="p-4 text-right font-medium text-slate-800">
                                  {product.price.toLocaleString()}
                              </td>
                              <td className="p-4 text-center">
                                  {product.stock} <span className="text-slate-400 text-xs">{product.unit}</span>
                              </td>
                              <td className="p-4 flex justify-center">
                                  {product.stock < product.minStockLevel ? (
                                      <span className="flex items-center gap-1 text-rose-600 bg-rose-50 px-2 py-1 rounded-full text-xs font-medium border border-rose-100">
                                          <AlertTriangle size={12} /> Low Stock
                                      </span>
                                  ) : (
                                      <span className="flex items-center gap-1 text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full text-xs font-medium border border-emerald-100">
                                          <CheckCircle size={12} /> Good
                                      </span>
                                  )}
                              </td>
                          </tr>
                      ))}
                  </tbody>
              </table>
            </div>
          </div>
        );
      };

      // --- COMPONENT: Subscription ---
      const Subscription = () => {
        return (
          <div className="p-8 max-w-6xl mx-auto">
              <div className="text-center mb-12">
                  <h2 className="text-3xl font-bold text-slate-800">Upgrade your Enterprise</h2>
                  <p className="text-slate-500 mt-2">Choose the plan that fits your retail scale. All plans include automated backups.</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                  {SAAS_PLANS.map(plan => (
                      <div key={plan.id} className={`relative bg-white rounded-2xl border ${plan.recommended ? 'border-indigo-500 shadow-xl scale-105 z-10' : 'border-slate-200 shadow-sm'} p-6 flex flex-col`}>
                          {plan.recommended && (
                              <div className="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-indigo-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide">
                                  Most Popular
                              </div>
                          )}
                          <h3 className="text-lg font-semibold text-slate-700">{plan.name}</h3>
                          <div className="mt-4 mb-6">
                              <span className="text-3xl font-bold text-slate-900">{plan.price}</span>
                          </div>
                          
                          <ul className="space-y-4 mb-8 flex-1">
                              {plan.features.map((feature, i) => (
                                  <li key={i} className="flex items-start gap-3 text-sm text-slate-600">
                                      <div className={`mt-0.5 rounded-full p-0.5 ${plan.recommended ? 'bg-indigo-100 text-indigo-600' : 'bg-slate-100 text-slate-500'}`}>
                                          <Check size={12} />
                                      </div>
                                      {feature}
                                  </li>
                              ))}
                          </ul>

                          <button className={`w-full py-3 rounded-xl font-semibold transition-all ${
                              plan.recommended 
                              ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-200' 
                              : 'bg-slate-50 text-slate-700 hover:bg-slate-100 border border-slate-200'
                          }`}>
                              {plan.id === 'enterprise' ? 'Contact Sales' : 'Upgrade Now'}
                          </button>
                      </div>
                  ))}
              </div>
          </div>
        );
      };

      // --- COMPONENT: Layout ---
      const Layout = ({ children, activeView, onNavigate }) => {
        const menuItems = [
          { id: 'dashboard', label: 'Dashboard', icon: LayoutGrid },
          { id: 'pos', label: 'POS Terminal', icon: ShoppingCart },
          { id: 'inventory', label: 'Inventory', icon: Package },
          { id: 'subscription', label: 'Subscription', icon: Store },
          { id: 'settings', label: 'Settings', icon: Settings },
        ];

        return (
          <div className="flex h-screen bg-slate-100 overflow-hidden font-sans">
            <div className="w-64 bg-slate-900 text-slate-300 flex flex-col shadow-xl z-20 hidden md:flex">
              <div className="p-6 flex items-center gap-3 border-b border-slate-800">
                <div className="bg-indigo-600 p-2 rounded-lg">
                  <ShoppingCart className="text-white w-6 h-6" />
                </div>
                <div>
                  <h1 className="font-bold text-white text-lg tracking-tight">RetailFlow</h1>
                  <p className="text-xs text-slate-500">Enterprise SaaS</p>
                </div>
              </div>

              <nav className="flex-1 p-4 space-y-2 mt-4">
                {menuItems.map(item => {
                  const Icon = item.icon;
                  return (
                    <button
                      key={item.id}
                      onClick={() => onNavigate(item.id)}
                      className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${
                        activeView === item.id 
                        ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-900/20' 
                        : 'hover:bg-slate-800 hover:text-white'
                      }`}
                    >
                      <Icon size={20} />
                      <span className="font-medium text-sm">{item.label}</span>
                    </button>
                  );
                })}
              </nav>

              <div className="p-4 border-t border-slate-800">
                <div className="bg-slate-800 rounded-xl p-3 flex items-center gap-3 mb-3">
                  <div className="w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center text-white font-bold text-xs">
                    LCC
                  </div>
                  <div className="flex-1 overflow-hidden">
                    <p className="text-sm font-semibold text-white truncate">Lahore C&C</p>
                    <p className="text-xs text-slate-500">Business Plan</p>
                  </div>
                </div>
                <button className="w-full flex items-center gap-3 px-4 py-2 text-slate-400 hover:text-white transition-colors">
                  <LogOut size={18} />
                  <span className="text-sm">Sign Out</span>
                </button>
              </div>
            </div>

            <div className="flex-1 flex flex-col overflow-hidden relative">
              <div className="md:hidden bg-slate-900 text-white p-4 flex justify-between items-center">
                  <h1 className="font-bold">RetailFlow</h1>
                  <button className="text-slate-300"><Settings size={20} /></button>
              </div>

              <main className="flex-1 overflow-auto bg-slate-50">
                {children}
              </main>
            </div>
          </div>
        );
      };

      // --- MAIN APP COMPONENT ---
      const App = () => {
        const [activeView, setActiveView] = useState('dashboard');
        
        const handleProcessSale = (total, items) => {
          console.log("Processing sale:", { total, items });
          alert(`Sale completed! Total: Rs ${total.toLocaleString()}`);
        };

        const renderContent = () => {
          switch (activeView) {
            case 'dashboard':
              return <Dashboard />;
            case 'pos':
              return <POSTerminal onProcessSale={handleProcessSale} />;
            case 'inventory':
              return <Inventory />;
            case 'subscription':
              return <Subscription />;
            default:
              return <div className="p-10 text-center text-slate-500">Feature coming soon: {activeView}</div>;
          }
        };

        return (
          <Layout activeView={activeView} onNavigate={setActiveView}>
            {renderContent()}
          </Layout>
        );
      };

      // --- RENDER ---
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>